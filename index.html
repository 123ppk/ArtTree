<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sunshot Products</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>

<style>
*{box-sizing:border-box;font-family:'Inter',sans-serif;}
body{margin:0;background:#fff;color:#000;}
header{display:flex;justify-content:space-between;align-items:center;padding:10px 15px;border-bottom:1px solid #ccc;background:#fafafa;}
header h1{color:orange;font-weight:700;font-size:22px;}
header button{background:black;color:#fff;border:none;padding:6px 12px;border-radius:6px;cursor:pointer;font-size:13px;}
.container{max-width:1000px;margin:15px auto;padding:10px;}
.form-area{display:none;max-width:400px;margin:0 auto;border:1px solid #ccc;border-radius:8px;padding:12px;background:#f9f9f9;}
.form-area input{width:100%;margin:4px 0;padding:8px;border:1px solid #ccc;border-radius:6px;font-size:13px;}
.form-area button{background:black;color:white;border:none;padding:8px 12px;border-radius:6px;margin-top:6px;cursor:pointer;font-size:13px;width:100%;}
.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-top:20px;}
.card{border:1px solid #ddd;border-radius:8px;padding:6px;text-align:center;background:#fff;}
.card img{width:100%;height:90px;object-fit:cover;border-radius:6px;cursor:pointer;margin-bottom:5px;transition:transform .3s;}
.card img:hover{transform:scale(1.05);}
.card h4{margin:3px 0;font-size:13px;font-weight:600;}
.card p{margin:2px 0;font-size:11px;}
.card button{background:black;color:white;border:none;padding:5px 8px;border-radius:5px;margin:2px;cursor:pointer;font-size:10px;}
.popup{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;justify-content:center;align-items:center;z-index:999;}
.popup-content{background:#fff;padding:15px;border-radius:8px;width:260px;text-align:center;}
.hidden{display:none;}
</style>
</head>
<body>

<header>
  <h1>Sunshot</h1>
  <div>
    <button id="loginBtn">Login</button>
    <button id="logoutBtn" class="hidden">Logout</button>
  </div>
</header>

<div class="container">
  <div class="form-area" id="formArea">
    <input type="text" id="pname" placeholder="Product Name">
    <input type="text" id="pmaterial" placeholder="Material">
    <input type="text" id="psize" placeholder="Size">
    <input type="number" id="pprice" placeholder="Price â‚¹">
    <input type="number" id="pqty" placeholder="Quantity">
    <input type="file" id="pimage" accept="image/*" multiple>
    <button id="addProductBtn">Add Product</button>
  </div>

  <div class="cards" id="cardsContainer"></div>
</div>

<!-- Payment popup -->
<div class="popup hidden" id="payPopup">
  <div class="popup-content">
    <h3 style="margin:0;font-size:14px;">Payment</h3>
    <img src="https://upload.wikimedia.org/wikipedia/commons/2/2a/QR_code_for_mobile_English_Wikipedia.svg" width="100"><br>
    <p style="font-size:12px;">Pay via GPay<br><b id="payAmount"></b></p>
    <button onclick="closePayPopup()" style="padding:4px 8px;font-size:11px;">Close</button>
  </div>
</div>

<script>
// ===================== FIREBASE SETUP =====================
const firebaseConfig = {
  apiKey: "AIzaSyAb4liarXpnl5GC1eXJ6FhQp_ULa_wQgSw",
  authDomain: "sunshot-d24a2.firebaseapp.com",
  databaseURL: "https://sunshot-d24a2-default-rtdb.firebaseio.com",
  projectId: "sunshot-d24a2",
  storageBucket: "sunshot-d24a2.appspot.com",
  messagingSenderId: "64784282158",
  appId: "1:64784282158:web:693fbf4cd1a46a676525bf",
  measurementId: "G-DLC7Q4KVHV"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const storage = firebase.storage();

// ðŸ”„ Force real-time refresh (fix sync delay)
firebase.database().goOffline();
firebase.database().goOnline();

// ===================== VARIABLES =====================
const ADMIN_EMAIL = "sunshot@gmail.com";
const ADMIN_PASS = "sun123";
let loggedIn = false;

const formArea = document.getElementById("formArea");
const cardsContainer = document.getElementById("cardsContainer");
const payPopup = document.getElementById("payPopup");
const payAmount = document.getElementById("payAmount");

// ===================== RENDER PRODUCTS =====================
function renderProducts(snapshot) {
  cardsContainer.innerHTML = "";
  snapshot.forEach(child => {
    const p = child.val();
    const key = child.key;
    let imgsHTML = p.images
      ? p.images.map(src => `<img src="${src}" onclick="openPayPopup(${p.total})">`).join("")
      : "";
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      ${imgsHTML}
      <h4>${p.name}</h4>
      <p>${p.material}</p>
      <p>Size: ${p.size}</p>
      <p>â‚¹${p.price} Ã— ${p.qty} = <b>â‚¹${p.total}</b></p>
      ${
        loggedIn
          ? `<button onclick="deleteProduct('${key}')">Delete</button>`
          : `<button onclick="openPayPopup(${p.total})">Buy</button>`
      }
    `;
    cardsContainer.appendChild(card);
  });
}

// ===================== ADD PRODUCT =====================
async function addProduct() {
  const name = document.getElementById("pname").value.trim();
  const material = document.getElementById("pmaterial").value.trim();
  const size = document.getElementById("psize").value.trim();
  const price = parseFloat(document.getElementById("pprice").value) || 0;
  const qty = parseInt(document.getElementById("pqty").value) || 1;
  const imgs = document.getElementById("pimage").files;

  if (!name || imgs.length === 0) {
    alert("âš ï¸ Please fill all fields and select image(s).");
    return;
  }

  const urls = [];
  for (const file of imgs) {
    const imgRef = storage.ref("images/" + Date.now() + "_" + file.name);
    await imgRef.put(file);
    const url = await imgRef.getDownloadURL();
    urls.push(url);
  }

  const total = price * qty;
  const product = { name, material, size, price, qty, total, images: urls };

  await db.ref("products").push(product);
  // ðŸ‘‡ Force refresh after adding
  db.ref("products").once("value").then(renderProducts);
  alert("âœ… Product added successfully!");
  document.querySelectorAll("#formArea input").forEach(i => (i.value = ""));
}

// ===================== DELETE PRODUCT =====================
function deleteProduct(id) {
  if (confirm("Delete this product?")) {
    db.ref("products/" + id).remove();
  }
}

// ===================== PAYMENT POPUP =====================
function openPayPopup(amount) {
  payAmount.textContent = "â‚¹" + amount;
  payPopup.classList.remove("hidden");
}
function closePayPopup() {
  payPopup.classList.add("hidden");
}

// ===================== LOGIN / LOGOUT =====================
document.getElementById("addProductBtn").onclick = addProduct;

document.getElementById("loginBtn").onclick = () => {
  const email = prompt("Enter admin email:");
  const pass = prompt("Enter password:");
  if (email === ADMIN_EMAIL && pass === ADMIN_PASS) {
    loggedIn = true;
    formArea.style.display = "block";
    document.getElementById("loginBtn").classList.add("hidden");
    document.getElementById("logoutBtn").classList.remove("hidden");
  } else {
    alert("Invalid credentials! Use sunshot@gmail.com / sun123");
  }
};

document.getElementById("logoutBtn").onclick = () => {
  loggedIn = false;
  formArea.style.display = "none";
  document.getElementById("loginBtn").classList.remove("hidden");
  document.getElementById("logoutBtn").classList.add("hidden");
};

// ===================== SYNC PRODUCTS =====================
db.ref("products").on("value", renderProducts);
</script>

</body>
</html>
