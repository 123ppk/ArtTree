<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Marriage Card Application</title>
<style>
  body { font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; background: #fff; color: #222; }
  header { text-align: center; padding: 20px; background: #f8f8f8; font-size: 24px; font-weight: bold; position: relative; }
  #logoutBtn { position: absolute; top: 15px; right: 20px; background: none; border: none; color: hotpink; font-size: 14px; cursor: pointer; font-weight: bold; }
  .container { max-width: 1200px; margin: auto; padding: 15px; }
  .login-box, .form-box { background: #fff; padding: 20px; margin: 10px auto; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); max-width: 400px; text-align: center; }
  input, select { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 8px; }
  button { background: hotpink; color: #fff; border: none; padding: 10px 20px; border-radius: 8px; margin-top: 10px; cursor: pointer; font-weight: bold; }
  button:hover { background: deeppink; }
  .search-bar { text-align: center; margin: 15px 0; }
  .search-bar input { width: 50%; max-width: 400px; }
  .card-grid { display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; }
  .card { width: calc(20% - 15px); background: #fff; padding: 10px; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); text-align: left; position: relative; }
  .card img { width: 100%; height: 120px; object-fit: cover; border-radius: 8px; cursor: zoom-in; }
  .card h3 { margin: 5px 0; font-size: 18px; }
  .card p { margin: 3px 0; font-size: 14px; }
  .card button { width: auto; padding: 5px 10px; margin-top: 5px; font-size: 12px; margin-right: 4px; }
  @media(max-width: 1024px){ .card { width: calc(33.3% - 15px); } }
  @media(max-width: 768px){ .card { width: calc(50% - 15px); } .search-bar input { width: 90%; } }
  @media(max-width: 480px){ .card { width: 100%; } }
</style>
</head>
<body>
<header>üíç Jodimazi <button id="logoutBtn" style="display:none;" onclick="logout()">Logout</button></header>

<div class="container">
  <div class="login-box" id="loginBox">
    <h2>Login</h2>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button onclick="login()">Login</button>
  </div>

  <div class="form-box" id="formBox" style="display:none;">
    <h2>Add Marriage Card</h2>
    <input type="text" id="name" placeholder="Name">
    <input type="text" id="address" placeholder="Address">
    <input type="text" id="education" placeholder="Education">
    <input type="number" id="salary" placeholder="Salary">
    <input type="number" id="age" placeholder="Age">
    <select id="gender">
      <option value="">Select Gender</option>
      <option value="Male">Male</option>
      <option value="Female">Female</option>
    </select>
    <input type="text" id="city" placeholder="City">
    <input type="text" id="contact" placeholder="Contact">
    <input type="date" id="startDate">
    <input type="date" id="endDate">
    <input type="file" id="photo">
    <input type="email" id="userEmail" placeholder="User Email">
    <input type="password" id="userPassword" placeholder="User Password">
    <button onclick="addCard()">Add Card</button>
  </div>

  <div class="search-bar" style="display:none;">
    <input type="text" id="searchInput" placeholder="Search by name..." onkeyup="searchCards()">
  </div>

  <div class="card-grid" id="cardGrid"></div>
</div>

<!-- ‚úÖ Firebase SDK add ‡§ï‡§∞‡§æ -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>

<script>
let currentUser=null;
const adminEmail="jodi@admin.com";
const adminPass="jodi123";

// ‚úÖ Firebase Config (‡§§‡•Å‡§ù‡§Ç project config ‡§ü‡§æ‡§ï)
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT_ID.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

function login(){
  const email=document.getElementById("email").value;
  const pass=document.getElementById("password").value;
  if(email===adminEmail && pass===adminPass){
    currentUser={role:"admin",email};
    document.getElementById("loginBox").style.display="none";
    document.getElementById("formBox").style.display="block";
    document.querySelector(".search-bar").style.display="block";
    document.getElementById("logoutBtn").style.display="inline";
    loadCards();
  } else {
    let users=JSON.parse(localStorage.getItem("users"))||[];
    let user=users.find(u=>u.email===email && u.password===pass);
    if(user){ currentUser={role:"user",email:user.email,gender:user.gender}; }
    else { alert("Invalid login"); return; }
    document.getElementById("loginBox").style.display="none";
    document.getElementById("formBox").style.display="none";
    document.querySelector(".search-bar").style.display="block";
    document.getElementById("logoutBtn").style.display="inline";
    loadCards();
  }
}

function logout(){
  currentUser=null;
  document.getElementById("loginBox").style.display="block";
  document.getElementById("formBox").style.display="none";
  document.querySelector(".search-bar").style.display="none";
  document.getElementById("logoutBtn").style.display="none";
  document.getElementById("cardGrid").innerHTML="";
}

function resizeImage(file,callback){
  const reader=new FileReader();
  reader.onload=function(event){
    const img=new Image();
    img.onload=function(){
      const canvas=document.createElement("canvas");
      const ctx=canvas.getContext("2d");
      const MAX_WIDTH=400;
      const scaleSize=MAX_WIDTH/img.width;
      canvas.width=MAX_WIDTH;
      canvas.height=img.height*scaleSize;
      ctx.drawImage(img,0,0,canvas.width,canvas.height);
      callback(canvas.toDataURL("image/jpeg",0.7));
    }
    img.src=event.target.result;
  }
  reader.readAsDataURL(file);
}

function addCard(){
  const file=document.getElementById("photo").files[0];
  if(file){ resizeImage(file,function(resized){ saveCardData(resized); }); }
  else { saveCardData(""); }
}

function saveCardData(photoData){
  const card={
    id: Date.now(),
    name: document.getElementById("name").value,
    address: document.getElementById("address").value,
    education: document.getElementById("education").value,
    salary: document.getElementById("salary").value,
    age: document.getElementById("age").value,
    gender: document.getElementById("gender").value,
    city: document.getElementById("city").value,
    contact: document.getElementById("contact").value,
    startDate: document.getElementById("startDate").value,
    endDate: document.getElementById("endDate").value,
    photo: photoData,
    userEmail: document.getElementById("userEmail").value,
    userPassword: document.getElementById("userPassword").value
  };
  let cards=JSON.parse(localStorage.getItem("cards"))||[];
  cards.push(card);
  localStorage.setItem("cards",JSON.stringify(cards));

  // ‚úÖ Firestore ‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§™‡§£ save ‡§ï‡§∞‡§æ
  db.collection("cards").add(card).then(()=>console.log("Synced to Firebase"));

  let users=JSON.parse(localStorage.getItem("users"))||[];
  if(!users.find(u=>u.email===card.userEmail)){
    users.push({email:card.userEmail,password:card.userPassword,gender:card.gender});
    localStorage.setItem("users",JSON.stringify(users));
  }
  clearForm();
  loadCards();
}

function clearForm(){
  ["name","address","education","salary","age","gender","city","contact","startDate","endDate","photo","userEmail","userPassword"].forEach(id=>document.getElementById(id).value="");
}

function editCard(id){
  let cards=JSON.parse(localStorage.getItem("cards"))||[];
  const card=cards.find(c=>c.id===id);
  if(!card) return;
  document.getElementById("name").value=card.name;
  document.getElementById("address").value=card.address;
  document.getElementById("education").value=card.education;
  document.getElementById("salary").value=card.salary;
  document.getElementById("age").value=card.age;
  document.getElementById("gender").value=card.gender;
  document.getElementById("city").value=card.city;
  document.getElementById("contact").value=card.contact;
  document.getElementById("startDate").value=card.startDate;
  document.getElementById("endDate").value=card.endDate;
  document.getElementById("userEmail").value=card.userEmail;
  document.getElementById("userPassword").value=card.userPassword;
  document.getElementById("formBox").scrollIntoView({behavior:"smooth"});
}

function saveCard(id){
  let cards=JSON.parse(localStorage.getItem("cards"))||[];
  const index=cards.findIndex(c=>c.id===id);
  if(index===-1) return;
  cards[index].name=document.getElementById("name").value;
  cards[index].address=document.getElementById("address").value;
  cards[index].education=document.getElementById("education").value;
  cards[index].salary=document.getElementById("salary").value;
  cards[index].age=document.getElementById("age").value;
  cards[index].gender=document.getElementById("gender").value;
  cards[index].city=document.getElementById("city").value;
  cards[index].contact=document.getElementById("contact").value;
  cards[index].startDate=document.getElementById("startDate").value;
  cards[index].endDate=document.getElementById("endDate").value;
  cards[index].userEmail=document.getElementById("userEmail").value;
  cards[index].userPassword=document.getElementById("userPassword").value;
  localStorage.setItem("cards",JSON.stringify(cards));

  // ‚úÖ Firebase update (overwrite ‡§ï‡§∞‡•Ç‡§®)
  db.collection("cards").doc(String(id)).set(cards[index]);

  loadCards();
  alert("Card updated successfully!");
}

function deleteCard(id){
  if(!confirm("Delete this card?")) return;
  let cards=JSON.parse(localStorage.getItem("cards"))||[];
  cards=cards.filter(c=>c.id!==id);
  localStorage.setItem("cards",JSON.stringify(cards));

  // ‚úÖ Firestore delete ‡§ï‡§∞‡§æ
  db.collection("cards").where("id","==",id).get().then(snapshot=>{
    snapshot.forEach(doc=>db.collection("cards").doc(doc.id).delete());
  });

  loadCards();
}

function loadCards(){
  let cards=JSON.parse(localStorage.getItem("cards"))||[];

  // ‚úÖ Firestore ‡§Æ‡§ß‡•Ç‡§® ‡§∏‡•Å‡§¶‡•ç‡§ß‡§æ ‡§ò‡•á‡§ä
  db.collection("cards").get().then(snapshot=>{
    snapshot.forEach(doc=>{
      const data=doc.data();
      if(!cards.find(c=>c.id===data.id)) cards.push(data);
    });
    localStorage.setItem("cards",JSON.stringify(cards));

    const today=new Date();
    cards=cards.filter(c=>{
      let expiry=new Date(c.startDate);
      expiry.setFullYear(expiry.getFullYear()+1);
      return new Date()<=expiry;
    });

    if(currentUser.role==="user"){
      cards=cards.filter(c=>currentUser.gender==="Male"?c.gender==="Female":c.gender==="Male");
    }

    const grid=document.getElementById("cardGrid");
    grid.innerHTML="";
    cards.forEach(card=>{
      const div=document.createElement("div");
      div.className="card";
      let adminButtons="";
      if(currentUser.role==="admin"){
        adminButtons=`<button onclick="editCard(${card.id})">Edit</button>
                      <button onclick="saveCard(${card.id})">Save</button>
                      <button onclick="deleteCard(${card.id})">Delete</button>`;
      }
      div.innerHTML=`
        <img src="${card.photo||'https://via.placeholder.com/150'}" onclick="zoomImage(this)">
        <h3>${card.name}</h3>
        <p>${card.address}</p>
        <p>${card.education}</p>
        <p>${card.salary}</p>
        <p>${card.age} | ${card.gender}</p>
        <p>${card.city}</p>
        <p>${card.contact}</p>
        ${adminButtons}
      `;
      grid.appendChild(div);
    });
  });
}

function zoomImage(img){
  img.style.transform=img.style.transform==="scale(2)"?"scale(1)":"scale(2)";
  img.style.transition="transform 0.3s ease";
}

function searchCards(){
  const q=document.getElementById("searchInput").value.toLowerCase();
  const cards=document.querySelectorAll(".card");
  cards.forEach(card=>{
    const name=card.querySelector("h3").innerText.toLowerCase();
    card.style.display=name.includes(q)?"block":"none";
  });
}
</script>
</body>
</html>
