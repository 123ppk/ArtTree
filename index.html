<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ArtTree - Your Link to Artfruit</title>
  <style>
    /* === ‡§§‡•Å‡§Æ‡§ö‡§æ ‡§Æ‡•Ç‡§≥ CSS ‡§ú‡§∏‡§æ‡§ö‡§æ ‡§§‡§∏‡§æ === */
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #fdf6f0;
      color: #333;
    }
    header {
      text-align: center;
      padding: 1em;
      background: #8e44ad;
      color: white;
      position: relative;
    }
    header h1 { margin: 0; font-size: 2em; }
    header p { margin: 0.2em 0; font-style: italic; }

    #headerButtons {
      position: absolute;
      top: 10px;
      right: 10px;
      display: flex;
      gap: 10px;
      align-items: center;
    }

    #headerButtons button {
      background: #b47ed6;
      border: none;
      color: white;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-family: inherit;
      font-size: 1em;
      transition: background-color 0.3s ease;
    }
    #headerButtons button:hover {
      background: #914bbd;
    }

    .container {
      max-width: 1000px;
      margin: auto;
      padding: 1em;
      text-align: center;
    }

    .login-section, .admin-panel {
      display: none;
    }

    input, button {
      margin: 0.5em 0;
      padding: 0.7em;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 1em;
      font-family: inherit;
    }

    input { width: 100%; }

    button {
      background: #b47ed6;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: 600;
    }

    .card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      margin: 1em;
      padding: 1em;
      text-align: center;
      position: relative;
      flex: 1 1 45%;
      max-width: 48%;
    }

    .card-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }

    .card img {
      width: 140px;
      height: 140px;
      object-fit: cover;
      border-radius: 12px;
      transition: transform 0.3s ease;
      cursor: zoom-in;
      user-select: none;
    }

    .card img.zoomed {
      transform: scale(3);
      z-index: 999;
      position: relative;
      cursor: zoom-out;
    }

    .card .art-images {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      padding: 25px;
    }

    .card .art-images img {
      width: 100px;
      height: 100px;
      object-fit: cover;
      border-radius: 8px;
      margin: 5px;
      transition: transform 0.3s ease;
      cursor: zoom-in;
      user-select: none;
    }

    .card .art-images img.zoomed {
      transform: scale(2.8);
      z-index: 999;
      position: relative;
      cursor: zoom-out;
    }

    .icons {
      margin-top: 1em;
    }

    .icons a {
      margin: 0 10px;
      color: #8e44ad;
      font-weight: bold;
      text-decoration: none;
    }

    .icons a:hover {
      text-decoration: underline;
    }

    .close-btn {
      position: absolute;
      top: 5px;
      right: 10px;
      cursor: pointer;
      font-size: 20px;
      color: red;
      user-select: none;
    }

    /* === Mobile Responsive Fixes - ONLY added === */
    @media (max-width: 600px) {
      .card {
        max-width: 100% !important;
        flex: 1 1 100% !important;
        margin: 0.5em 0 !important;
      }
      header h1 {
        font-size: 1.5em !important;
      }
      #headerButtons {
        position: static !important;
        justify-content: center;
        margin-top: 10px;
      }
      #headerButtons button {
        padding: 6px 12px !important;
        font-size: 0.9em !important;
      }
      .card img {
        width: 120px !important;
        height: 120px !important;
      }
      .card .art-images img {
        width: 80px !important;
        height: 80px !important;
        margin: 3px !important;
      }
    }
  </style>
</head>
<body>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js"></script>

<header>
  <h1>ArtTree</h1>
  <p>Your link to the artfruit üçá</p>
  <div id="headerButtons">
    <button id="loginHeaderBtn" onclick="showLoginPopup()">Login</button>
    <button id="logoutBtn" style="display:none;" onclick="logout()">Logout</button>
  </div>
</header>

<div class="container">

  <div class="login-section" id="loginSection" style="display:none;">
    <h2>Login</h2>
    <input type="email" id="email" placeholder="Enter email" autocomplete="username" />
    <input type="password" id="password" placeholder="Enter password" autocomplete="current-password" />
    <button onclick="login()">Login</button>
  </div>

  <div class="admin-panel" id="adminPanel">
    <h2>Add Artist Card</h2>
    <input type="text" id="artistName" placeholder="Artist Name" />
    <input type="text" id="artistCategory" placeholder="Enter Category" />
    <input type="text" id="instaLink" placeholder="Instagram Link" />
    <input type="text" id="artLink" placeholder="Portfolio/Art Link" />
    <input type="month" id="monthStart" placeholder="Month Start Date" />
    <input type="month" id="monthEnd" placeholder="Month End Date" />
    <input type="file" id="profilePic" accept="image/*" />
    <label>Upload up to 10 Art Images</label>
    <input type="file" id="artImages" accept="image/*" multiple />
    <button onclick="addCard()">Add Artist Card</button>
    <hr />
  </div>

  <div class="card-container" id="cardList"></div>
</div>

<script>
  // Firebase config - Change these to your Firebase project config
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT_ID.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID",
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // Elements
  const loginSection = document.getElementById("loginSection");
  const adminPanel = document.getElementById("adminPanel");
  const logoutBtn = document.getElementById("logoutBtn");
  const loginHeaderBtn = document.getElementById("loginHeaderBtn");
  const cardList = document.getElementById("cardList");
  const adminEmail = "admin@arttree.com";

  // Cache cards
  let storedCards = [];

  // Show login popup
  function showLoginPopup() {
    loginSection.style.display = "block";
    adminPanel.style.display = "none";
    loginSection.style.position = "fixed";
    loginSection.style.top = "50%";
    loginSection.style.left = "50%";
    loginSection.style.transform = "translate(-50%, -50%)";
    loginSection.style.background = "#fff";
    loginSection.style.padding = "20px";
    loginSection.style.borderRadius = "12px";
    loginSection.style.boxShadow = "0 4px 12px rgba(0,0,0,0.2)";
    loginSection.style.zIndex = "10000";
  }

  function hideLoginPopup() {
    loginSection.style.display = "none";
    loginSection.style.position = "";
    loginSection.style.top = "";
    loginSection.style.left = "";
    loginSection.style.transform = "";
    loginSection.style.background = "";
    loginSection.style.padding = "";
    loginSection.style.borderRadius = "";
    loginSection.style.boxShadow = "";
    loginSection.style.zIndex = "";
  }

  // Logout function
  function logout() {
    userType = "";
    hideLoginPopup();
    adminPanel.style.display = "none";
    logoutBtn.style.display = "none";
    loginHeaderBtn.style.display = "inline-block";
    showAllCards(false);
  }

  // User type
  let userType = "";

  // Login function
  function login() {
    const email = document.getElementById("email").value.trim().toLowerCase();
    const password = document.getElementById("password").value.trim();
    if (!email || !password) {
      alert("Fill all fields");
      return;
    }

    // Simple check for admin user
    if (email === adminEmail && password === "admin123") {
      userType = "admin";
      hideLoginPopup();
      adminPanel.style.display = "block";
      logoutBtn.style.display = "inline-block";
      loginHeaderBtn.style.display = "none";
      loadCardsFromFirestore();
    } else {
      alert("Wrong email or password");
    }
  }

  // Resize image + convert to base64
  function resizeAndReadImage(file, callback) {
    const reader = new FileReader();
    reader.onload = function (e) {
      const img = new Image();
      img.onload = function () {
        const canvas = document.createElement("canvas");
        const maxSize = 300;
        let width = img.width;
        let height = img.height;

        if (width > height) {
          if (width > maxSize) {
            height *= maxSize / width;
            width = maxSize;
          }
        } else {
          if (height > maxSize) {
            width *= maxSize / height;
            height = maxSize;
          }
        }
        canvas.width = width;
        canvas.height = height;
        canvas.getContext("2d").drawImage(img, 0, 0, width, height);
        callback(canvas.toDataURL("image/jpeg", 0.7));
      };
      img.src = e.target.result;
    };
    reader.readAsDataURL(file);
  }

  // Add card + sync with Firestore
  function addCard() {
    const name = document.getElementById("artistName").value.trim();
    const category = document.getElementById("artistCategory").value.trim() || "Uncategorized";
    const insta = document.getElementById("instaLink").value.trim();
    const art = document.getElementById("artLink").value.trim();
    const monthStart = document.getElementById("monthStart").value;
    const monthEnd = document.getElementById("monthEnd").value;
    const profileFile = document.getElementById("profilePic").files[0];
    const artFiles = document.getElementById("artImages").files;

    if (!name || !insta || !art || !profileFile || artFiles.length < 1 || !monthStart || !monthEnd) {
      alert("Please fill all fields and add images including Month Start and End dates");
      return;
    }

    resizeAndReadImage(profileFile, (profileData) => {
      let artDataList = [];
      let loaded = 0;
      const maxArts = Math.min(artFiles.length, 10);
      for (let i = 0; i < maxArts; i++) {
        resizeAndReadImage(artFiles[i], (imgData) => {
          artDataList.push(imgData);
          loaded++;
          if (loaded === maxArts) {
            const createdDate = new Date().toISOString();
            const card = {
              name,
              category,
              insta,
              art,
              monthStart,
              monthEnd,
              profile: profileData,
              arts: artDataList,
              created: createdDate,
            };
            db.collection("artistCards")
              .add(card)
              .then(() => {
                alert("Artist card saved successfully!");
                clearForm();
                loadCardsFromFirestore();
              })
              .catch((e) => alert("Error saving card: " + e.message));
          }
        });
      }
    });
  }

  // Clear form after add
  function clearForm() {
    document.getElementById("artistName").value = "";
    document.getElementById("artistCategory").value = "";
    document.getElementById("instaLink").value = "";
    document.getElementById("artLink").value = "";
    document.getElementById("monthStart").value = "";
    document.getElementById("monthEnd").value = "";
    document.getElementById("profilePic").value = "";
    document.getElementById("artImages").value = "";
  }

  // Load cards from Firestore
  async function loadCardsFromFirestore() {
    try {
      const snapshot = await db.collection("artistCards").orderBy("created", "desc").get();
      storedCards = [];
      snapshot.forEach((doc) => {
        storedCards.push({ ...doc.data(), docId: doc.id });
      });
      showAllCards(userType === "admin");
    } catch (e) {
      alert("Error loading cards: " + e.message);
    }
  }

  // Delete card
  function deleteCard(index) {
    if (confirm("Delete this artist card?")) {
      const docId = storedCards[index]?.docId;
      if (!docId) {
        alert("Card not found in database");
        return;
      }
      db.collection("artistCards")
        .doc(docId)
        .delete()
        .then(() => {
          alert("Card deleted successfully");
          loadCardsFromFirestore();
        })
        .catch((e) => alert("Error deleting card: " + e.message));
    }
  }

  // Show cards on page
  function showAllCards(showAdmin = false) {
    cardList.innerHTML = "";

    storedCards.forEach((card, index) => {
      const div = document.createElement("div");
      div.className = "card";
      div.setAttribute("data-category", card.category || "Uncategorized");

      div.innerHTML = `
        ${showAdmin ? `<span class="close-btn" onclick="deleteCard(${index})" title="Delete this artist card">√ó</span>` : ''}
        <img src="${card.profile}" onclick="toggleZoom(this)" alt="Profile Image"/>
        <h3>${card.name}</h3>
        <div><strong>Month Start:</strong> ${card.monthStart || '-'}</div>
        <div><strong>Month End:</strong> ${card.monthEnd || '-'}</div>
        <div class="icons">
          <a href="${card.insta}" target="_blank" rel="noopener noreferrer">Instagram</a>
          <a href="${card.art}" target="_blank" rel="noopener noreferrer">Art Link</a>
        </div>
        <div class="art-images">
          ${card.arts.map(a => `<img src="${a}" onclick="toggleZoom(this)" alt="Art Image" />`).join('')}
        </div>
      `;
      cardList.appendChild(div);
    });

    adminPanel.style.display = showAdmin ? "block" : "none";
  }

  // Zoom image toggler
  function toggleZoom(img) {
    document.querySelectorAll('.zoomed').forEach(el => {
      if(el !== img) el.classList.remove('zoomed');
    });
    img.classList.toggle('zoomed');
  }

  // On page load: show public cards and login button, load from Firestore
  window.onload = () => {
    loginHeaderBtn.style.display = "inline-block";
    logoutBtn.style.display = "none";
    loadCardsFromFirestore();
  };
</script>

</body>
</html>
